#a basic hello test with no layers

DEFAULT_SHIM_STACK_NAMES = '(ClientServerShim,[CoordinationShim],[CoordinationShim][FECShim][PhysConn])'

include layermain.repy
include StandardShims.repy
include FECShim.repy


def echo(remotekey,remoteport,msg,handle):
  # echo back one char at a time
  mycontext['msg-in'].append(msg)
  


if callfunc == 'initialize':

  mycontext['msg-in']=[]
  
  serverkey = 'UDPFEC'
  
  handle = layered_recvmess(serverkey,12345,echo)

  for i in range(10):
    i = str(i)
    layered_sendmess(serverkey,12345,i)
  
  sleep(1) #allow messages to arrive    
  
  
  
  layered_stopcomm(handle)
  
  if mycontext['msg-in'] != ['0','1','2','3','4','5','6','7','8','9']:
    print 'FAILED: '+str(mycontext['msg-in'])
